<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sample">

<delete id="sample.studyBoarddelete" parameterType="hashmap">
<![CDATA[ DELETE FROM TB_BOARDLIST WHERE BOARD_IDX = #{board_idx} ]]>
</delete>

<update id="sample.studyBoardUpdate" parameterType="hashmap"> 
<![CDATA[ UPDATE TB_BOARDLIST SET BOARD_NAME=#{board_name}, BOARD_FIELD = #{board_field} WHERE BOARD_IDX = #{board_idx} ]]>
</update>

<select id="sample.openBoardList" resultType="hashmap" parameterType="hashmap" >
   <![CDATA[
       SELECT
           IDX,
           TITLE,
           HIT_CNT,
           CREA_DTM,
           BOARD_IDX,
           BOARD_NAME
       FROM
           TB_BOARD
       WHERE
           DEL_GB= 'N' and board_idx=#{board_idx}
       ORDER BY 
           IDX DESC
   ]]>
</select>

<select id="sample.selectBoardManageList" resultType="hashmap" parameterType="hashmap" >
  SELECT * FROM TB_BOARDLIST
</select>

<select id="sample.writeList" resultType="hashmap" parameterType="hashmap" >
  SELECT * FROM TB_BOARDLIST WHERE BOARD_IDX = #{board_idx}
</select>

	<insert id="insertBoardManagement" parameterType="hashmap">
	<![CDATA[ INSERT INTO TB_BOARDLIST ( board_name, board_date, board_field ) VALUES ( #{board_name}, current_timestamp, #{board_field} ) ]]>
	</insert>

	<select id="sample.selectBoardList" resultType="hashmap" parameterType="hashmap" >
   <![CDATA[
       SELECT
           (
               SELECT
                   COUNT(*) 
               FROM 
                   TB_BOARD
               WHERE 
                   DEL_GB = 'N'
           ) AS TOTAL_COUNT ,
           IDX,
           TITLE,
           HIT_CNT,
           CREA_DTM
       FROM
           TB_BOARD
       WHERE
           DEL_GB= 'N'
       ORDER BY 
           IDX DESC
       LIMIT #{START} , #{END} 
   ]]>
</select>


	<insert id="insertBoard" parameterType="hashmap"
		useGeneratedKeys="true" keyProperty="IDX">
	<![CDATA[ INSERT INTO TB_BOARD (BOARD_IDX, BOARD_NAME, TITLE, CONTENTS, HIT_CNT, DEL_GB, CREA_DTM, CREA_ID, GENDER, COMMENT ) VALUES (#{board_idx}, #{board_name}, #{TITLE}, #{CONTENTS}, 0, 'N', current_timestamp, 'Admin', #{gender}, #{comment} ) ]]>
	</insert>

	<update id="updateHitCnt" parameterType="hashmap">
	<![CDATA[ UPDATE TB_BOARD SET HIT_CNT = IFNULL(HIT_CNT, 0) + 1 WHERE IDX = #{IDX} ]]>
	</update>

	<select id="selectBoardDetail" parameterType="hashmap"
		resultType="hashmap"> <![CDATA[ SELECT BOARD_IDX, IDX, HIT_CNT, CREA_ID, CREA_DTM, TITLE, CONTENTS, GENDER, COMMENT FROM TB_BOARD WHERE IDX = #{IDX}]]>
	</select>

	<update id="updateBoard" parameterType="hashmap"> 
		<![CDATA[ UPDATE TB_BOARD SET TITLE = #{TITLE}, CONTENTS = #{CONTENTS}, GENDER = #{gender}, COMMENT=#{comment} WHERE IDX = #{IDX} ]]>
	</update>

	<update id="deleteBoard" parameterType="hashmap">
		<![CDATA[ UPDATE TB_BOARD SET DEL_GB = 'Y' WHERE IDX = #{IDX} ]]>
	</update>

	<insert id="insertFile" parameterType="hashmap"> 
		<![CDATA[ INSERT INTO TB_FILE ( BOARD_IDX, ORIGINAL_FILE_NAME, STORED_FILE_NAME, FILE_SIZE, CREA_ID ) VALUES ( #{BOARD_IDX}, #{ORIGINAL_FILE_NAME}, #{STORED_FILE_NAME}, #{FILE_SIZE}, 'Admin' ) ]]>
	</insert>

	<select id="selectFileList" parameterType="hashmap" resultType="hashmap">
		 <![CDATA[ SELECT IDX, ORIGINAL_FILE_NAME, ROUND(FILE_SIZE/1024,1) AS FILE_SIZE FROM TB_FILE WHERE BOARD_IDX = #{IDX} AND DEL_GB = 'N' ]]>
	</select>

	<update id="deleteFileList" parameterType="hashmap">
	<![CDATA[ UPDATE TB_FILE SET DEL_GB = 'Y' WHERE BOARD_IDX = #{IDX} ]]>
	</update>
	
	<update id="updateFile" parameterType="hashmap">
	<![CDATA[ UPDATE TB_FILE SET DEL_GB = 'N' WHERE IDX = #{FILE_IDX} ]]>
	</update>


</mapper>